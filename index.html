<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squid Game: Red Light, Green Light - Scene 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 720px;
            height: 1280px;
            overflow: hidden;
            position: relative;
            background: #1a1a1a;
            font-family: 'Arial', sans-serif;
        }

        #scene-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #three-canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        .atmospheric-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }

        .dust-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            opacity: 0;
        }

        .player-nameplate {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            opacity: 0;
            transform: translateY(20px);
        }

        .nameplate-messi {
            bottom: 25%;
            left: 12%;
            color: #ff6b6b;
            border-color: #ff6b6b;
        }

        .nameplate-ronaldo {
            bottom: 25%;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            color: #4ecdc4;
            border-color: #4ecdc4;
        }

        .nameplate-neymar {
            bottom: 25%;
            right: 12%;
            color: #feca57;
            border-color: #feca57;
        }

        .tension-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 80%, rgba(255, 0, 0, 0.05) 0%, transparent 60%);
            z-index: 2;
            opacity: 0;
        }

        .wind-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
        }

        .wind-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="scene-container">
        <canvas id="three-canvas"></canvas>
        
        <div class="ui-overlay">
            <div class="player-nameplate nameplate-messi">MESSI ðŸ‡¦ðŸ‡·</div>
            <div class="player-nameplate nameplate-ronaldo">RONALDO ðŸ‡µðŸ‡¹</div>
            <div class="player-nameplate nameplate-neymar">NEYMAR ðŸ‡§ðŸ‡·</div>
        </div>
        
        <div class="atmospheric-particles"></div>
        
        <div class="tension-overlay"></div>
        
        <div class="wind-lines"></div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>

    <script>
        // Global variables
        let scene, camera, renderer, clock;
        let players = [];
        let ground, doll, particles = [];
        let dustParticles = [];
        let windLines = [];

        // Scene setup
        function initScene() {
            // Create scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0xa8b8c8, 10, 100);

            // Create camera
            camera = new THREE.PerspectiveCamera(45, 720 / 1280, 0.1, 1000);
            camera.position.set(0, 8, 20);
            camera.lookAt(0, 0, 0);

            // Create renderer
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('three-canvas'),
                antialias: true,
                alpha: true
            });
            renderer.setSize(720, 1280);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.setClearColor(0xa8b8c8, 1);

            // Clock for animations
            clock = new THREE.Clock();

            // Lighting
            setupLighting();
            
            // Create environment
            createGround();
            createDoll();
            createStartingLine();
            
            // Create players
            createPlayers();
            
            // Create particle systems
            createParticleSystem();
            
            // Create atmospheric effects
            createAtmosphericEffects();
            
            // Start animations
            startAnimations();
            
            // Render loop
            animate();
        }

        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);

            // Main directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -20;
            directionalLight.shadow.camera.right = 20;
            directionalLight.shadow.camera.top = 20;
            directionalLight.shadow.camera.bottom = -20;
            scene.add(directionalLight);

            // Atmospheric light
            const atmosphericLight = new THREE.DirectionalLight(0xffa500, 0.3);
            atmosphericLight.position.set(-10, 10, -10);
            scene.add(atmosphericLight);

            // Point light for drama
            const pointLight = new THREE.PointLight(0xff4444, 0.5, 30);
            pointLight.position.set(0, 5, -15);
            scene.add(pointLight);
        }

        function createGround() {
            // Ground geometry
            const groundGeometry = new THREE.PlaneGeometry(50, 50, 100, 100);
            
            // Ground material with texture-like appearance
            const groundMaterial = new THREE.MeshLambertMaterial({
                color: 0xd4c4a8,
                transparent: true,
                opacity: 0.9
            });

            ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -1;
            ground.receiveShadow = true;
            scene.add(ground);

            // Add ground texture variation
            const vertices = ground.geometry.attributes.position.array;
            for (let i = 0; i < vertices.length; i += 3) {
                vertices[i + 2] += (Math.random() - 0.5) * 0.1;
            }
            ground.geometry.attributes.position.needsUpdate = true;
        }

        function createDoll() {
            // Doll silhouette in background
            const dollGeometry = new THREE.CylinderGeometry(0.8, 1.2, 4, 8);
            const dollMaterial = new THREE.MeshLambertMaterial({
                color: 0xff6b6b,
                transparent: true,
                opacity: 0.3
            });
            
            doll = new THREE.Mesh(dollGeometry, dollMaterial);
            doll.position.set(8, 2, -20);
            doll.castShadow = true;
            scene.add(doll);

            // Doll head
            const headGeometry = new THREE.SphereGeometry(0.6, 8, 8);
            const headMaterial = new THREE.MeshLambertMaterial({
                color: 0xff8e8e,
                transparent: true,
                opacity: 0.3
            });
            
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0, 2.5, 0);
            doll.add(head);
        }

        function createStartingLine() {
            const lineGeometry = new THREE.BoxGeometry(20, 0.1, 0.2);
            const lineMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            
            const startingLine = new THREE.Mesh(lineGeometry, lineMaterial);
            startingLine.position.set(0, 0, 8);
            startingLine.castShadow = true;
            scene.add(startingLine);
        }

        function createPlayers() {
            const playerColors = [0xff6b6b, 0x4ecdc4, 0xfeca57];
            const playerPositions = [-6, 0, 6];
            const playerNames = ['Messi', 'Ronaldo', 'Neymar'];

            for (let i = 0; i < 3; i++) {
                // Player body
                const bodyGeometry = new THREE.BoxGeometry(1, 2, 0.5);
                const bodyMaterial = new THREE.MeshLambertMaterial({ color: playerColors[i] });
                const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                body.position.set(playerPositions[i], 1, 8);
                body.castShadow = true;
                body.receiveShadow = true;
                
                // Player head
                const headGeometry = new THREE.SphereGeometry(0.4, 8, 8);
                const headMaterial = new THREE.MeshLambertMaterial({ color: 0xfdbcb4 });
                const head = new THREE.Mesh(headGeometry, headMaterial);
                head.position.set(0, 1.4, 0);
                head.castShadow = true;
                body.add(head);

                // Player arms
                const armGeometry = new THREE.CylinderGeometry(0.1, 0.1, 1.2);
                const armMaterial = new THREE.MeshLambertMaterial({ color: playerColors[i] });
                
                const leftArm = new THREE.Mesh(armGeometry, armMaterial);
                leftArm.position.set(-0.7, 0.3, 0);
                leftArm.rotation.z = 0.3;
                leftArm.castShadow = true;
                body.add(leftArm);
                
                const rightArm = new THREE.Mesh(armGeometry, armMaterial);
                rightArm.position.set(0.7, 0.3, 0);
                rightArm.rotation.z = -0.3;
                rightArm.castShadow = true;
                body.add(rightArm);

                // Player legs
                const legGeometry = new THREE.CylinderGeometry(0.15, 0.15, 1.5);
                const legMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
                
                const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
                leftLeg.position.set(-0.3, -1.25, 0);
                leftLeg.castShadow = true;
                body.add(leftLeg);
                
                const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
                rightLeg.position.set(0.3, -1.25, 0);
                rightLeg.castShadow = true;
                body.add(rightLeg);

                scene.add(body);
                players.push({
                    body: body,
                    head: head,
                    leftArm: leftArm,
                    rightArm: rightArm,
                    name: playerNames[i],
                    originalY: body.position.y
                });
            }
        }

        function createParticleSystem() {
            // Atmospheric particles
            const particleCount = 50;
            const particleGeometry = new THREE.BufferGeometry();
            const particlePositions = new Float32Array(particleCount * 3);
            const particleVelocities = [];

            for (let i = 0; i < particleCount; i++) {
                particlePositions[i * 3] = (Math.random() - 0.5) * 50;
                particlePositions[i * 3 + 1] = Math.random() * 20;
                particlePositions[i * 3 + 2] = (Math.random() - 0.5) * 50;
                
                particleVelocities.push({
                    x: (Math.random() - 0.5) * 0.02,
                    y: Math.random() * 0.01,
                    z: (Math.random() - 0.5) * 0.02
                });
            }

            particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
            
            const particleMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                transparent: true,
                opacity: 0.6
            });

            const particleSystem = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particleSystem);
            
            particles.push({
                system: particleSystem,
                velocities: particleVelocities,
                geometry: particleGeometry
            });
        }

        function createAtmosphericEffects() {
            // Create dust particles in DOM
            const particleContainer = document.querySelector('.atmospheric-particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'dust-particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particleContainer.appendChild(particle);
                dustParticles.push(particle);
            }

            // Create wind lines
            const windContainer = document.querySelector('.wind-lines');
            for (let i = 0; i < 10; i++) {
                const line = document.createElement('div');
                line.className = 'wind-line';
                line.style.width = Math.random() * 200 + 100 + 'px';
                line.style.top = Math.random() * 100 + '%';
                line.style.left = '-200px';
                windContainer.appendChild(line);
                windLines.push(line);
            }
        }

        function startAnimations() {
            // Player breathing animation
            players.forEach((player, index) => {
                gsap.to(player.body.position, {
                    y: player.originalY + 0.1,
                    duration: 2 + index * 0.5,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut"
                });

                // Head subtle movement
                gsap.to(player.head.rotation, {
                    y: 0.1,
                    duration: 3 + index * 0.3,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut"
                });

                // Arm sway
                gsap.to(player.leftArm.rotation, {
                    z: 0.4,
                    duration: 2.5 + index * 0.2,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut"
                });

                gsap.to(player.rightArm.rotation, {
                    z: -0.4,
                    duration: 2.3 + index * 0.2,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut"
                });
            });

            // Doll subtle movement
            gsap.to(doll.rotation, {
                y: 0.05,
                duration: 8,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });

            // Camera subtle movement
            gsap.to(camera.position, {
                y: 8.5,
                duration: 6,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });

            gsap.to(camera.position, {
                x: 0.5,
                duration: 8,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });

            // Animate nameplates
            gsap.to('.player-nameplate', {
                opacity: 1,
                y: 0,
                duration: 2,
                delay: 1,
                stagger: 0.3,
                ease: "back.out(1.7)"
            });

            // Tension overlay pulse
            gsap.to('.tension-overlay', {
                opacity: 0.3,
                duration: 4,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });

            // Animate dust particles
            dustParticles.forEach((particle, index) => {
                gsap.set(particle, { opacity: 0, y: 20 });
                gsap.to(particle, {
                    opacity: 1,
                    y: -20,
                    x: Math.random() * 100 - 50,
                    duration: 10 + Math.random() * 5,
                    repeat: -1,
                    delay: index * 0.5,
                    ease: "none"
                });
            });

            // Animate wind lines
            windLines.forEach((line, index) => {
                gsap.set(line, { x: -200, opacity: 0 });
                gsap.to(line, {
                    x: 920,
                    opacity: 0.3,
                    duration: 3 + Math.random() * 2,
                    repeat: -1,
                    delay: index * 0.8,
                    ease: "none",
                    onComplete: function() {
                        gsap.set(line, { x: -200, opacity: 0 });
                    }
                });
            });
        }

        function animate() {
            requestAnimationFrame(animate);

            const deltaTime = clock.getDelta();
            const elapsedTime = clock.getElapsedTime();

            // Update particles
            particles.forEach(particleObj => {
                const positions = particleObj.geometry.attributes.position.array;
                const velocities = particleObj.velocities;

                for (let i = 0; i < positions.length; i += 3) {
                    positions[i] += velocities[i / 3].x;
                    positions[i + 1] += velocities[i / 3].y;
                    positions[i + 2] += velocities[i / 3].z;

                    // Reset particles that go out of bounds
                    if (positions[i] > 25) positions[i] = -25;
                    if (positions[i] < -25) positions[i] = 25;
                    if (positions[i + 1] > 20) positions[i + 1] = 0;
                    if (positions[i + 2] > 25) positions[i + 2] = -25;
                    if (positions[i + 2] < -25) positions[i + 2] = 25;
                }

                particleObj.geometry.attributes.position.needsUpdate = true;
            });

            // Subtle ground wave
            const groundVertices = ground.geometry.attributes.position.array;
            for (let i = 0; i < groundVertices.length; i += 3) {
                groundVertices[i + 2] = Math.sin(elapsedTime * 0.5 + groundVertices[i] * 0.1) * 0.05;
            }
            ground.geometry.attributes.position.needsUpdate = true;

            // Update camera look at with slight sway
            camera.lookAt(
                Math.sin(elapsedTime * 0.2) * 0.5,
                Math.cos(elapsedTime * 0.3) * 0.2,
                0
            );

            renderer.render(scene, camera);
        }

        // Initialize scene when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing Squid Game Scene 1 with Three.js...');
            initScene();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            camera.aspect = 720 / 1280;
            camera.updateProjectionMatrix();
            renderer.setSize(720, 1280);
        });
    </script>
</body>
</html>
