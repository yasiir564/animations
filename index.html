<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Player Matching Animation</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .game-container {
            width: 720px;
            height: 1280px;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 25%, #32CD32 50%, #228B22 75%, #006400 100%);
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            border: 3px solid #fff;
        }

        /* Enhanced stadium background */
        .stadium-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at center bottom, rgba(255,255,255,0.1) 0%, transparent 70%),
                linear-gradient(90deg, 
                    rgba(255,255,255,0.05) 0%, 
                    transparent 10%, 
                    transparent 90%, 
                    rgba(255,255,255,0.05) 100%
                );
        }

        .field-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(90deg, transparent 48%, rgba(255,255,255,0.3) 49%, rgba(255,255,255,0.3) 51%, transparent 52%),
                linear-gradient(0deg, transparent 48%, rgba(255,255,255,0.2) 49%, rgba(255,255,255,0.2) 51%, transparent 52%),
                radial-gradient(circle at 50% 50%, rgba(255,255,255,0.2) 100px, transparent 105px);
            background-size: 100% 100%, 100% 100%, 300px 300px;
            background-position: center, center, center;
        }

        .crowd-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, transparent 100%);
            border-radius: 20px 20px 0 0;
        }

        /* Countdown */
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            font-weight: 900;
            color: #fff;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.8);
            z-index: 100;
            opacity: 0;
            animation: countdownPulse 1s ease-in-out;
        }

        .countdown.show {
            opacity: 1;
        }

        .title-overlay {
            position: absolute;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 48px;
            font-weight: 900;
            color: #fff;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            text-align: center;
            z-index: 50;
            opacity: 0;
            animation: titleSlide 2s ease-out forwards;
        }

        .faces-section {
            position: absolute;
            top: 250px;
            left: 0;
            right: 0;
            height: 300px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 40px;
            z-index: 10;
        }

        .player-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(-50px);
        }

        .player-card.appear {
            opacity: 1;
            transform: translateY(0);
            animation: playerAppear 0.8s ease-out;
        }

        .face-img {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 6px solid #fff;
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
            object-fit: cover;
            background: #f0f0f0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            z-index: 15;
        }

        .face-img.selected {
            animation: playerPulse 0.8s ease-in-out;
            transform: scale(1.2);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
        }

        .face-img.correct-match {
            animation: successGlow 1.5s ease-in-out;
            border-color: #00ff88;
        }

        .face-img.wrong-match {
            animation: errorShake 0.8s ease-in-out;
            border-color: #ff4757;
        }

        .player-name {
            font-size: 28px;
            font-weight: 800;
            color: #fff;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: rgba(0,0,0,0.4);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .bodies-section {
            position: absolute;
            top: 650px;
            left: 0;
            right: 0;
            height: 480px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 40px;
            z-index: 5;
        }

        .body-slot {
            width: 160px;
            height: 220px;
            position: relative;
            border: 4px dashed rgba(255,255,255,0.6);
            border-radius: 20px;
            overflow: hidden;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transform: translateY(50px);
        }

        .body-slot.appear {
            opacity: 1;
            transform: translateY(0);
            animation: slotAppear 0.8s ease-out;
        }

        .body-slot.matched {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
            box-shadow: 0 0 35px rgba(0, 255, 136, 0.6);
            animation: slotSuccess 1s ease-in-out;
        }

        .body-slot.wrong {
            border-color: #ff4757;
            background: rgba(255, 71, 87, 0.2);
            animation: slotShake 0.8s ease-in-out;
        }

        .body-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 16px;
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            transform: scale(0.3) rotate(15deg);
        }

        .body-img.appear {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .body-img.matched {
            border: 4px solid #00ff88;
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.7);
        }

        .feedback-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            font-weight: 900;
            opacity: 0;
            z-index: 30;
            pointer-events: none;
        }

        .feedback-overlay.show {
            opacity: 1;
            animation: feedbackPop 1.2s ease-in-out;
        }

        .success-feedback {
            background: linear-gradient(135deg, #00ff88 0%, #00d4aa 100%);
            color: white;
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.6);
        }

        .error-feedback {
            background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%);
            color: white;
            box-shadow: 0 15px 40px rgba(255, 71, 87, 0.6);
        }

        .connection-line {
            position: absolute;
            background: linear-gradient(90deg, #00ff88 0%, #00d4aa 100%);
            height: 6px;
            border-radius: 3px;
            transform-origin: left center;
            opacity: 0;
            z-index: 12;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
        }

        .connection-line.draw {
            opacity: 1;
            animation: drawConnection 1.2s ease-in-out;
        }

        .victory-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.95) 0%, rgba(0, 212, 170, 0.95) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            z-index: 50;
            backdrop-filter: blur(20px);
            border-radius: 20px;
        }

        .victory-screen.show {
            opacity: 1;
            animation: victoryFade 2s ease-in-out;
        }

        .victory-text {
            font-size: 64px;
            font-weight: 900;
            color: #fff;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.5);
            text-align: center;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .victory-emoji {
            font-size: 120px;
            animation: bounce 2s infinite;
        }

        .particle-system {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 25;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffd700;
            border-radius: 50%;
            opacity: 0;
        }

        .particle.celebrate {
            animation: particleCelebrate 3s ease-out forwards;
        }

        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            opacity: 0;
        }

        .confetti.fall {
            animation: confettiFall 4s ease-out forwards;
        }

        .progress-bar {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            z-index: 20;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88 0%, #00d4aa 100%);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 4px;
        }

        /* Enhanced animations */
        @keyframes countdownPulse {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        @keyframes titleSlide {
            0% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
            100% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        @keyframes playerAppear {
            0% { opacity: 0; transform: translateY(-50px) scale(0.8); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes slotAppear {
            0% { opacity: 0; transform: translateY(50px) scale(0.8); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes playerPulse {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.3); }
        }

        @keyframes successGlow {
            0% { transform: scale(1.2); box-shadow: 0 12px 35px rgba(0,0,0,0.4); }
            50% { transform: scale(1.4); box-shadow: 0 20px 50px rgba(0, 255, 136, 0.8); }
            100% { transform: scale(1.2); box-shadow: 0 12px 35px rgba(0,0,0,0.4); }
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        @keyframes slotShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }

        @keyframes slotSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes feedbackPop {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @keyframes drawConnection {
            0% { transform: scaleX(0); opacity: 0; }
            100% { transform: scaleX(1); opacity: 1; }
        }

        @keyframes victoryFade {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        @keyframes particleCelebrate {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-300px) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(1400px) rotate(720deg);
                opacity: 0;
            }
        }

        /* Mobile optimization */
        @media (max-width: 768px) {
            .game-container {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
                border: none;
            }
            
            .title-overlay {
                font-size: 36px;
            }
            
            .face-img {
                width: 100px;
                height: 100px;
            }
            
            .player-name {
                font-size: 20px;
            }
            
            .body-slot {
                width: 120px;
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Music -->
    <audio id="bgMusic" loop>
        <source src="background_music.mp3" type="audio/mpeg">
        <source src="background_music.ogg" type="audio/ogg">
    </audio>

    <!-- Sound Effects -->
    <audio id="successSound" preload="auto">
        <source src="success.mp3" type="audio/mpeg">
        <source src="success.ogg" type="audio/ogg">
    </audio>

    <audio id="failSound" preload="auto">
        <source src="fail.mp3" type="audio/mpeg">
        <source src="fail.ogg" type="audio/ogg">
    </audio>

    <div class="game-container">
        <div class="stadium-bg"></div>
        <div class="field-lines"></div>
        <div class="crowd-effect"></div>
        
        <div class="title-overlay">MATCH THE PLAYERS!</div>
        
        <div class="countdown" id="countdown">3</div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="faces-section">
            <div class="player-card" id="playerCard1">
                <img src="face_messi.png" alt="Messi" class="face-img" id="face1">
                <div class="player-name">Messi</div>
            </div>
            <div class="player-card" id="playerCard2">
                <img src="face_ronaldo.png" alt="Ronaldo" class="face-img" id="face2">
                <div class="player-name">Ronaldo</div>
            </div>
            <div class="player-card" id="playerCard3">
                <img src="face_neymar.png" alt="Neymar" class="face-img" id="face3">
                <div class="player-name">Neymar</div>
            </div>
        </div>

        <div class="bodies-section">
            <div class="body-slot" id="slot1">
                <div class="feedback-overlay success-feedback" id="successFeedback1">‚úì</div>
                <div class="feedback-overlay error-feedback" id="errorFeedback1">‚úó</div>
            </div>
            <div class="body-slot" id="slot2">
                <div class="feedback-overlay success-feedback" id="successFeedback2">‚úì</div>
                <div class="feedback-overlay error-feedback" id="errorFeedback2">‚úó</div>
            </div>
            <div class="body-slot" id="slot3">
                <div class="feedback-overlay success-feedback" id="successFeedback3">‚úì</div>
                <div class="feedback-overlay error-feedback" id="errorFeedback3">‚úó</div>
            </div>
        </div>

        <div class="victory-screen" id="victoryScreen">
            <div class="victory-emoji">üèÜ</div>
            <div class="victory-text">Perfect Match!</div>
        </div>

        <div class="particle-system" id="particleSystem"></div>
    </div>

    <script>
        // Game state
        let gameState = {
            currentPlayer: 0, // 0: Messi, 1: Ronaldo, 2: Neymar
            currentAttempt: 0,
            score: 0,
            isPlaying: false,
            matches: [false, false, false],
            playerOrder: [0, 1, 2], // Messi, Ronaldo, Neymar
            bodyImages: [
                'body_messi.png',    // Messi with Barca kit
                'body_ronaldo.png',  // Ronaldo with Real Madrid kit
                'body_neymar.png'    // Neymar with Brazil kit
            ],
            correctMatches: [0, 1, 2], // Each player matches with their respective body
            wrongSlots: [
                [1, 2], // Messi wrong slots
                [0, 2], // Ronaldo wrong slots  
                [0, 1]  // Neymar wrong slots
            ]
        };

        // Audio elements
        const bgMusic = document.getElementById('bgMusic');
        const successSound = document.getElementById('successSound');
        const failSound = document.getElementById('failSound');

        function playSound(sound) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log('Audio play failed:', e));
        }

        function startBackgroundMusic() {
            bgMusic.volume = 0.3;
            bgMusic.play().catch(e => console.log('Background music play failed:', e));
        }

        function updateProgress() {
            const progress = (gameState.score / 3) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function createParticles(x, y, count = 15) {
            const particleSystem = document.getElementById('particleSystem');
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = (x - 50 + Math.random() * 100) + 'px';
                particle.style.top = (y - 50 + Math.random() * 100) + 'px';
                particle.style.background = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'][Math.floor(Math.random() * 5)];
                particle.style.animationDelay = Math.random() * 0.5 + 's';
                particle.style.animationDuration = Math.random() * 2 + 2 + 's';
                
                particleSystem.appendChild(particle);
                particle.classList.add('celebrate');
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 4000);
            }
        }

        function createConfetti() {
            const particleSystem = document.getElementById('particleSystem');
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 720 + 'px';
                confetti.style.top = '-50px';
                confetti.style.background = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffd700', '#ff9ff3'][Math.floor(Math.random() * 6)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = Math.random() * 2 + 3 + 's';
                
                particleSystem.appendChild(confetti);
                confetti.classList.add('fall');
                
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 6000);
            }
        }

        function drawConnectionLine(fromElement, toElement) {
            const fromRect = fromElement.getBoundingClientRect();
            const toRect = toElement.getBoundingClientRect();
            const container = document.querySelector('.game-container');
            const containerRect = container.getBoundingClientRect();
            
            const fromX = fromRect.left + fromRect.width / 2 - containerRect.left;
            const fromY = fromRect.top + fromRect.height / 2 - containerRect.top;
            const toX = toRect.left + toRect.width / 2 - containerRect.left;
            const toY = toRect.top + toRect.height / 2 - containerRect.top;
            
            const distance = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
            const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
            
            const line = document.createElement('div');
            line.className = 'connection-line';
            line.style.left = fromX + 'px';
            line.style.top = fromY + 'px';
            line.style.width = distance + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            
            container.appendChild(line);
            
            setTimeout(() => {
                line.classList.add('draw');
            }, 200);
            
            return line;
        }

        function showFeedback(slotIndex, isCorrect) {
            const feedbackId = isCorrect ? `successFeedback${slotIndex + 1}` : `errorFeedback${slotIndex + 1}`;
            const feedback = document.getElementById(feedbackId);
            
            feedback.classList.add('show');
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 1200);
        }

        function placeBodyInSlot(slotIndex, bodyIndex) {
            const slot = document.getElementById(`slot${slotIndex + 1}`);
            const existingImg = slot.querySelector('.body-img');
            
            if (existingImg) {
                existingImg.remove();
            }
            
            const img = document.createElement('img');
            img.src = gameState.bodyImages[bodyIndex];
            img.className = 'body-img';
            img.alt = `Body ${bodyIndex + 1}`;
            slot.appendChild(img);
            
            setTimeout(() => {
                img.classList.add('appear');
            }, 100);
            
            return img;
        }

        function tryMatch(playerIndex, slotIndex) {
            const isCorrect = gameState.correctMatches[playerIndex] === slotIndex;
            const face = document.getElementById(`face${playerIndex + 1}`);
            const slot = document.getElementById(`slot${slotIndex + 1}`);
            
            // Select the face
            face.classList.add('selected');
            
            setTimeout(() => {
                if (isCorrect) {
                    // Correct match
                    gameState.matches[playerIndex] = true;
                    gameState.score++;
                    
                    face.classList.remove('selected');
                    face.classList.add('correct-match');
                    slot.classList.add('matched');
                    
                    const img = placeBodyInSlot(slotIndex, playerIndex);
                    
                    setTimeout(() => {
                        const connectionLine = drawConnectionLine(face, slot);
                        showFeedback(slotIndex, true);
                        playSound(successSound);
                        
                        setTimeout(() => {
                            img.classList.add('matched');
                        }, 500);
                        
                        createParticles(
                            slot.getBoundingClientRect().left + slot.offsetWidth / 2 - document.querySelector('.game-container').getBoundingClientRect().left,
                            slot.getBoundingClientRect().top + slot.offsetHeight / 2 - document.querySelector('.game-container').getBoundingClientRect().top,
                            20
                        );
                        
                        updateProgress();
                        
                        // Move to next player after delay
                        setTimeout(() => {
                            face.classList.remove('correct-match');
                            if (gameState.score === 3) {
                                showVictory();
                            } else {
                                gameState.currentPlayer++;
                                gameState.currentAttempt = 0;
                                setTimeout(() => {
                                    animateNextPlayer();
                                }, 1000);
                            }
                        }, 1500);
                    }, 300);
                } else {
                    // Wrong match
                    face.classList.remove('selected');
                    face.classList.add('wrong-match');
                    slot.classList.add('wrong');
                    
                    showFeedback(slotIndex, false);
                    playSound(failSound);
                    
                    setTimeout(() => {
                        face.classList.remove('wrong-match');
                        slot.classList.remove('wrong');
                        
                        // Try next slot after delay
                        setTimeout(() => {
                            gameState.currentAttempt++;
                            animateNextPlayer();
                        }, 800);
                    }, 800);
                }
            }, 1000);
        }

        function animateNextPlayer() {
            if (gameState.currentPlayer >= 3) return;
            
            const playerIndex = gameState.playerOrder[gameState.currentPlayer];
            const wrongSlots = gameState.wrongSlots[playerIndex];
            
            // Determine which slot to try
            let slotIndex;
            if (gameState.currentAttempt < wrongSlots.length) {
                // Try wrong slot first
                slotIndex = wrongSlots[gameState.currentAttempt];
            } else {
                // Try correct slot
                slotIndex = gameState.correctMatches[playerIndex];
            }
            
            tryMatch(playerIndex, slotIndex);
        }

        function showVictory() {
            const victoryScreen = document.getElementById('victoryScreen');
            victoryScreen.classList.add('show');
            
            createConfetti();
            
            // Reset game after 5 seconds
            setTimeout(() => {
                resetGame();
            }, 5000);
        }

        function resetGame() {
            // Reset game state
            gameState.currentPlayer = 0;
            gameState.currentAttempt = 0;
            gameState.score = 0;
            gameState.matches = [false, false, false];
            gameState.isPlaying = false;
            
            // Remove victory screen
            const victoryScreen = document.getElementById('victoryScreen');
            victoryScreen.classList.remove('show');
            
            // Clear all body images
            for (let i = 1; i <= 3; i++) {
                const slot = document.getElementById(`slot${i}`);
                const img = slot.querySelector('.body-img');
                if (img) {
                    img.remove();
                }
                slot.classList.remove('matched', 'wrong');
            }
            
            // Reset face animations
            for (let i = 1; i <= 3; i++) {
                const face = document.getElementById(`face${i}`);
                face.classList.remove('selected', 'correct-match', 'wrong-match');
            }
            
            // Remove all connection lines
            const lines = document.querySelectorAll('.connection-line');
            lines.forEach(line => line.remove());
            
            // Clear particles
            const particleSystem = document.getElementById('particleSystem');
            particleSystem.innerHTML = '';
            
            // Reset progress
            updateProgress();
            
            // Start new game after delay
            setTimeout(() => {
                startGame();
            }, 2000);
        }

        function startCountdown() {
            const countdown = document.getElementById('countdown');
            let count = 3;
            
            function showCount() {
                countdown.textContent = count;
                countdown.classList.add('show');
                
                setTimeout(() => {
                    countdown.classList.remove('show');
                    count--;
                    
                    if (count > 0) {
                        setTimeout(showCount, 500);
                    } else {
                        setTimeout(() => {
                            countdown.textContent = 'GO!';
                            countdown.classList.add('show');
                            
                            setTimeout(() => {
                                countdown.classList.remove('show');
                                gameState.isPlaying = true;
                                startBackgroundMusic();
                                showPlayersAndSlots();
                            }, 1000);
                        }, 500);
                    }
                }, 1000);
            }
            
            showCount();
        }

        function showPlayersAndSlots() {
            // Show player cards
            const playerCards = document.querySelectorAll('.player-card');
            playerCards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('appear');
                }, index * 200);
            });
            
            // Show body slots
            const bodySlots = document.querySelectorAll('.body-slot');
            bodySlots.forEach((slot, index) => {
                setTimeout(() => {
                    slot.classList.add('appear');
                }, 1000 + index * 200);
            });
            
            // Start the matching sequence
            setTimeout(() => {
                animateNextPlayer();
            }, 2500);
        }

        function startGame() {
            // Reset all elements
            const playerCards = document.querySelectorAll('.player-card');
            const bodySlots = document.querySelectorAll('.body-slot');
            
            playerCards.forEach(card => card.classList.remove('appear'));
            bodySlots.forEach(slot => slot.classList.remove('appear'));
            
            // Start countdown
            setTimeout(() => {
                startCountdown();
            }, 1000);
        }

        // Auto-start the game when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                startGame();
            }, 1000);
        });

        // Handle audio interaction requirement
        document.addEventListener('click', () => {
            if (bgMusic.paused && gameState.isPlaying) {
                startBackgroundMusic();
            }
        });
    </script>
</body>
</html>
